# Feature 0005: Internationalization (i18n) Support

## Context
Implement comprehensive internationalization support for Traditional Chinese and English languages. This feature will enable the app to display content in multiple languages, support RTL layouts, and provide a seamless multilingual experience across all features.

**Prerequisite**: Features 0000, 0001, 0002, 0003, 0004 should be completed first.

**MVP Scope**: English and Traditional Chinese support, basic RTL layout support, localized content.

## Technical Plan

### Phase 1: i18n Foundation & Configuration

#### i18n Configuration
- **File**: `lib/i18n.ts`
- **Changes**: Create i18n configuration with react-i18next
```typescript
import i18n from 'i18next';
import { initReactI18next } from 'react-i18next';
import * as Localization from 'expo-localization';
import AsyncStorage from '@react-native-async-storage/async-storage';

const resources = {
  en: {
    translation: require('../locales/en.json'),
  },
  'zh-Hant': {
    translation: require('../locales/zh-Hant.json'),
  },
};

i18n
  .use(initReactI18next)
  .init({
    resources,
    lng: Localization.locale,
    fallbackLng: 'en',
    interpolation: {
      escapeValue: false,
    },
    react: {
      useSuspense: false,
    },
  });

export default i18n;
```

#### Language Detection Service
- **File**: `services/languageService.ts`
- **Changes**: Create service for language detection and management
```typescript
- detectDeviceLanguage(): Promise<string>
- getUserLanguage(): Promise<string>
- setUserLanguage(language: string): Promise<void>
- getSupportedLanguages(): Language[]
- isRTL(language: string): boolean
- getLanguageDisplayName(language: string): string
```

#### Type Definitions
- **File**: `types/i18n.ts`
- **Changes**: Define TypeScript interfaces for i18n
```typescript
interface Language {
  code: string;
  name: string;
  nativeName: string;
  isRTL: boolean;
  flag: string;
}

interface TranslationNamespace {
  common: CommonTranslations;
  auth: AuthTranslations;
  discovery: DiscoveryTranslations;
  subscription: SubscriptionTranslations;
  search: SearchTranslations;
  errors: ErrorTranslations;
}

interface CommonTranslations {
  loading: string;
  error: string;
  retry: string;
  cancel: string;
  save: string;
  delete: string;
  edit: string;
  search: string;
  filter: string;
  sort: string;
  settings: string;
  profile: string;
  logout: string;
}

interface AuthTranslations {
  signIn: string;
  signInWithApple: string;
  signInWithGoogle: string;
  welcome: string;
  termsOfService: string;
  privacyPolicy: string;
}

interface DiscoveryTranslations {
  createDiscovery: string;
  addNote: string;
  addPhoto: string;
  category: string;
  likedIt: string;
  didntLikeIt: string;
  wantToTry: string;
  discoveryType: string;
  book: string;
  music: string;
  movie: string;
  food: string;
  drink: string;
  place: string;
  product: string;
  other: string;
  processing: string;
  completed: string;
  failed: string;
}

interface SearchTranslations {
  searchDiscoveries: string;
  searchPlaceholder: string;
  noResults: string;
  filterByCategory: string;
  filterByType: string;
  clearFilters: string;
  searchHistory: string;
  searchSuggestions: string;
}

interface SubscriptionTranslations {
  subscription: string;
  currentPlan: string;
  upgrade: string;
  downgrade: string;
  cancel: string;
  usage: string;
  billing: string;
  free: string;
  premium: string;
  pro: string;
  monthly: string;
  yearly: string;
  features: string;
  limits: string;
}
```

### Phase 2: Translation Files

#### English Translations
- **File**: `locales/en.json`
- **Changes**: Create comprehensive English translation file
```json
{
  "common": {
    "loading": "Loading...",
    "error": "Error",
    "retry": "Retry",
    "cancel": "Cancel",
    "save": "Save",
    "delete": "Delete",
    "edit": "Edit",
    "search": "Search",
    "filter": "Filter",
    "sort": "Sort",
    "settings": "Settings",
    "profile": "Profile",
    "logout": "Logout"
  },
  "auth": {
    "signIn": "Sign In",
    "signInWithApple": "Sign in with Apple",
    "signInWithGoogle": "Sign in with Google",
    "welcome": "Welcome to TasteTrackAI",
    "termsOfService": "Terms of Service",
    "privacyPolicy": "Privacy Policy"
  },
  "discovery": {
    "createDiscovery": "Create Discovery",
    "addNote": "Add your thoughts...",
    "addPhoto": "Add Photo",
    "category": "Category",
    "likedIt": "Liked It",
    "didntLikeIt": "Didn't Like It",
    "wantToTry": "Want to Try",
    "discoveryType": "Type",
    "book": "Book",
    "music": "Music",
    "movie": "Movie",
    "food": "Food",
    "drink": "Drink",
    "place": "Place",
    "product": "Product",
    "other": "Other",
    "processing": "Processing...",
    "completed": "Completed",
    "failed": "Failed"
  },
  "search": {
    "searchDiscoveries": "Search Discoveries",
    "searchPlaceholder": "Search your discoveries...",
    "noResults": "No results found",
    "filterByCategory": "Filter by Category",
    "filterByType": "Filter by Type",
    "clearFilters": "Clear Filters",
    "searchHistory": "Search History",
    "searchSuggestions": "Suggestions"
  },
  "subscription": {
    "subscription": "Subscription",
    "currentPlan": "Current Plan",
    "upgrade": "Upgrade",
    "downgrade": "Downgrade",
    "cancel": "Cancel",
    "usage": "Usage",
    "billing": "Billing",
    "free": "Free",
    "premium": "Premium",
    "pro": "Pro",
    "monthly": "Monthly",
    "yearly": "Yearly",
    "features": "Features",
    "limits": "Limits"
  }
}
```

#### Traditional Chinese Translations
- **File**: `locales/zh-Hant.json`
- **Changes**: Create comprehensive Traditional Chinese translation file
```json
{
  "common": {
    "loading": "載入中...",
    "error": "錯誤",
    "retry": "重試",
    "cancel": "取消",
    "save": "儲存",
    "delete": "刪除",
    "edit": "編輯",
    "search": "搜尋",
    "filter": "篩選",
    "sort": "排序",
    "settings": "設定",
    "profile": "個人資料",
    "logout": "登出"
  },
  "auth": {
    "signIn": "登入",
    "signInWithApple": "使用 Apple 登入",
    "signInWithGoogle": "使用 Google 登入",
    "welcome": "歡迎使用 TasteTrackAI",
    "termsOfService": "服務條款",
    "privacyPolicy": "隱私政策"
  },
  "discovery": {
    "createDiscovery": "建立發現",
    "addNote": "添加您的想法...",
    "addPhoto": "添加照片",
    "category": "分類",
    "likedIt": "喜歡",
    "didntLikeIt": "不喜歡",
    "wantToTry": "想嘗試",
    "discoveryType": "類型",
    "book": "書籍",
    "music": "音樂",
    "movie": "電影",
    "food": "食物",
    "drink": "飲品",
    "place": "地點",
    "product": "產品",
    "other": "其他",
    "processing": "處理中...",
    "completed": "完成",
    "failed": "失敗"
  },
  "search": {
    "searchDiscoveries": "搜尋發現",
    "searchPlaceholder": "搜尋您的發現...",
    "noResults": "找不到結果",
    "filterByCategory": "按分類篩選",
    "filterByType": "按類型篩選",
    "clearFilters": "清除篩選",
    "searchHistory": "搜尋歷史",
    "searchSuggestions": "建議"
  },
  "subscription": {
    "subscription": "訂閱",
    "currentPlan": "目前方案",
    "upgrade": "升級",
    "downgrade": "降級",
    "cancel": "取消",
    "usage": "使用量",
    "billing": "帳單",
    "free": "免費",
    "premium": "進階",
    "pro": "專業",
    "monthly": "月付",
    "yearly": "年付",
    "features": "功能",
    "limits": "限制"
  }
}
```

### Phase 3: i18n Components & Hooks

#### Language Selector Component
- **File**: `components/i18n/LanguageSelector.tsx`
- **Changes**: Create language selection component
- **Features**:
  - Language dropdown/selector
  - Flag icons for each language
  - Native language names
  - RTL support indicator

#### i18n Hook
- **File**: `hooks/useI18n.ts`
- **Changes**: Create custom hook for i18n
```typescript
- useTranslation(namespace?: string): TranslationFunction
- useLanguage(): Language
- useLanguageSelector(): LanguageSelector
- useRTL(): boolean
```

#### RTL Layout Component
- **File**: `components/i18n/RTLProvider.tsx`
- **Changes**: Create RTL layout provider
- **Features**:
  - Automatic RTL detection
  - Layout direction switching
  - Text alignment handling
  - Icon direction adjustment

### Phase 4: Database & Content Localization

#### Database Schema Updates
- **File**: `supabase/migrations/005_add_i18n_support.sql`
- **Changes**: Add i18n support to database
```sql
-- Add language preference to users table
ALTER TABLE auth.users ADD COLUMN language_preference TEXT DEFAULT 'en';

-- Create localized content table for dynamic content
CREATE TABLE localized_content (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  content_key TEXT NOT NULL,
  language_code TEXT NOT NULL,
  content_value TEXT NOT NULL,
  content_type TEXT NOT NULL, -- 'text', 'html', 'markdown'
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  UNIQUE(content_key, language_code)
);

-- Add language support to subscription plans
ALTER TABLE subscription_plans ADD COLUMN localized_names JSONB;
ALTER TABLE subscription_plans ADD COLUMN localized_descriptions JSONB;

-- Indexes
CREATE INDEX idx_localized_content_key ON localized_content(content_key);
CREATE INDEX idx_localized_content_language ON localized_content(language_code);
```

#### Content Localization Service
- **File**: `services/contentLocalizationService.ts`
- **Changes**: Create service for dynamic content localization
```typescript
- getLocalizedContent(key: string, language: string): Promise<string>
- setLocalizedContent(key: string, language: string, content: string): Promise<void>
- getLocalizedSubscriptionPlan(planId: string, language: string): Promise<SubscriptionPlan>
- updateLocalizedSubscriptionPlan(planId: string, language: string, data: any): Promise<void>
```

### Phase 5: State Management

#### i18n Store
- **File**: `stores/i18nStore.ts`
- **Changes**: Create Zustand store for i18n state
```typescript
interface I18nStore {
  currentLanguage: string;
  supportedLanguages: Language[];
  isRTL: boolean;
  isLoading: boolean;
  
  // Actions
  setLanguage: (language: string) => Promise<void>;
  loadSupportedLanguages: () => Promise<void>;
  detectLanguage: () => Promise<void>;
}
```

### Phase 6: Integration Across Features

#### Authentication Integration
- **File**: `app/(auth)/login.tsx`
- **Changes**: Add i18n support to auth screens
- **Features**:
  - Localized welcome messages
  - Translated button labels
  - Localized terms and privacy links
  - RTL layout support

#### Discovery Integration
- **File**: `app/(tabs)/create.tsx`
- **Changes**: Add i18n support to discovery creation
- **Features**:
  - Localized form labels
  - Translated category options
  - Localized discovery types
  - RTL text input support

#### Search Integration
- **File**: `app/(tabs)/search.tsx`
- **Changes**: Add i18n support to search screens
- **Features**:
  - Localized search placeholders
  - Translated filter options
  - Localized search results
  - RTL search input support

#### Subscription Integration
- **File**: `app/(tabs)/subscription.tsx`
- **Changes**: Add i18n support to subscription screens
- **Features**:
  - Localized plan names and descriptions
  - Translated feature lists
  - Localized pricing display
  - RTL layout for subscription cards

#### Settings Integration
- **File**: `app/(tabs)/settings.tsx`
- **Changes**: Add language selection to settings
- **Features**:
  - Language preference setting
  - Localized settings labels
  - RTL layout support
  - Language change confirmation

## Algorithms

### Language Detection Flow
1. **User Preference**: Check user's saved language preference
2. **Device Language**: Detect device's primary language
3. **Supported Language**: Match against supported languages
4. **Fallback**: Use English as default fallback
5. **Storage**: Save detected language preference
6. **UI Update**: Update app language immediately

### Content Localization Flow
1. **Content Request**: Request localized content by key
2. **Language Check**: Determine current language
3. **Database Query**: Fetch localized content from database
4. **Fallback Chain**: Fallback to English if not found
5. **Cache**: Cache localized content for performance
6. **Return**: Return localized content to component

### RTL Layout Algorithm
1. **Language Detection**: Check if current language is RTL
2. **Layout Direction**: Set layout direction (LTR/RTL)
3. **Text Alignment**: Adjust text alignment automatically
4. **Icon Direction**: Flip icons and images as needed
5. **Navigation**: Adjust navigation flow direction
6. **Input Fields**: Handle RTL text input properly

## Files to Create/Modify

### New Files
- `lib/i18n.ts`
- `services/languageService.ts`
- `services/contentLocalizationService.ts`
- `components/i18n/LanguageSelector.tsx`
- `components/i18n/RTLProvider.tsx`
- `hooks/useI18n.ts`
- `stores/i18nStore.ts`
- `types/i18n.ts`
- `locales/en.json`
- `locales/zh-Hant.json`
- `utils/i18nUtils.ts`

### Modified Files
- `app/_layout.tsx` - Add i18n provider
- `app/(auth)/login.tsx` - Add translations
- `app/(tabs)/create.tsx` - Add translations
- `app/(tabs)/search.tsx` - Add translations
- `app/(tabs)/subscription.tsx` - Add translations
- `app/(tabs)/settings.tsx` - Add language selection
- `components/discovery/DiscoveryCard.tsx` - Add translations
- `components/search/SearchBar.tsx` - Add translations
- `components/subscription/PlanComparison.tsx` - Add translations
- `package.json` - Add i18n dependencies

### Dependencies to Add
```json
{
  "react-i18next": "latest",
  "i18next": "latest",
  "expo-localization": "latest",
  "@react-native-async-storage/async-storage": "latest"
}
```

### App Configuration Updates
- **File**: `app.json`
- **Changes**: Add localization configuration
```json
{
  "expo": {
    "locales": {
      "en": "./locales/en.json",
      "zh-Hant": "./locales/zh-Hant.json"
    },
    "ios": {
      "infoPlist": {
        "CFBundleLocalizations": ["en", "zh-Hant"]
      }
    },
    "android": {
      "locales": {
        "en": "English",
        "zh-Hant": "繁體中文"
      }
    }
  }
}
```

## Success Criteria
- [ ] App supports English and Traditional Chinese
- [ ] Language preference is saved and persisted
- [ ] All UI text is properly translated
- [ ] RTL layout works correctly for future languages
- [ ] Language switching works without app restart
- [ ] Dynamic content can be localized
- [ ] Search works in both languages
- [ ] Subscription plans are localized
- [ ] Error messages are translated
- [ ] Date and number formatting is localized 