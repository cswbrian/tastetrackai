# Feature 0001: Basic Discovery Creation (MVP)

## Context
Implement core discovery creation functionality that allows users to write notes, add photos, and categorize experiences. This is the primary feature that defines the app's value proposition.

**Prerequisite**: Feature 0000 (Authentication) must be completed first.

**MVP Scope**: Basic discovery creation, simple timeline view, core database operations with future scalability preparation.

## Technical Plan

### Phase 1: Data Layer & Types

#### Database Schema Changes
- **File**: `supabase/migrations/001_create_discoveries_table.sql`
- **Changes**: Create discoveries table with location support and future LLM/queue preparation
```sql
CREATE TABLE discoveries (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id),
  text_content TEXT NOT NULL,
  category TEXT NOT NULL CHECK (category IN ('liked_it', 'didnt_like_it', 'want_to_try')),
  discovery_type TEXT,
  image_url TEXT,
  location_lat DECIMAL(10, 8),
  location_lng DECIMAL(11, 8),
  location_name TEXT,
  location_source TEXT CHECK (location_source IN ('gps', 'exif', 'manual', 'none')),
  -- Future LLM support (MVP: NULL, Future: JSONB)
  extracted_data JSONB,
  -- Future queue support (MVP: NULL, Future: status tracking)
  processing_status TEXT DEFAULT 'pending' CHECK (processing_status IN ('pending', 'processing', 'completed', 'failed')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Indexes for performance
CREATE INDEX idx_discoveries_user_id ON discoveries(user_id);
CREATE INDEX idx_discoveries_created_at ON discoveries(created_at DESC);
CREATE INDEX idx_discoveries_location ON discoveries(location_lat, location_lng);
CREATE INDEX idx_discoveries_location_source ON discoveries(location_source);
-- Future indexes (commented for MVP)
-- CREATE INDEX idx_discoveries_processing_status ON discoveries(processing_status);
-- CREATE INDEX idx_discoveries_extracted_data ON discoveries USING GIN (extracted_data);
```

#### Basic Type Definitions
- **File**: `types/discovery.ts`
- **Changes**: Define essential TypeScript interfaces with future scalability
```typescript
interface Discovery {
  id: string;
  user_id: string;
  text_content: string;
  category: 'liked_it' | 'didnt_like_it' | 'want_to_try';
  discovery_type?: string;
  image_url?: string;
  location_lat?: number;
  location_lng?: number;
  location_name?: string;
  location_source?: 'gps' | 'exif' | 'manual' | 'none';
  // Future LLM support
  extracted_data?: ExtractedData;
  processing_status?: 'pending' | 'processing' | 'completed' | 'failed';
  created_at: string;
  updated_at: string;
}

interface DiscoveryInput {
  text_content: string;
  category: 'liked_it' | 'didnt_like_it' | 'want_to_try';
  discovery_type?: string;
  image_url?: string;
  location_lat?: number;
  location_lng?: number;
  location_name?: string;
  location_source?: 'gps' | 'exif' | 'manual' | 'none';
}

interface LocationData {
  latitude: number;
  longitude: number;
  name?: string;
  source: 'gps' | 'exif' | 'manual' | 'none';
}

// Future LLM types (commented for MVP)
/*
interface ExtractedData {
  keywords: string[];
  entities: Record<string, string>;
  sub_types: string[];
  confidence_scores: Record<string, number>;
}
*/
```

### Phase 2: Core UI Components

#### Discovery Creation Screen
- **File**: `app/(tabs)/create.tsx`
- **Changes**: Create basic discovery creation screen with location capture
- **Components**:
  - Text input for notes
  - Photo capture/selection button
  - Category selection (Liked It, Didn't Like It, Want to Try)
  - Discovery type dropdown (Book, Music, Movie, Food, Drink, Place, Product)
  - Location capture indicator (GPS/EXIF/Manual)
  - Location name display (if available)
  - Manual location edit option
  - Save button with loading state
  - Future: Processing status indicator (commented for MVP)

#### Discovery Card Component
- **File**: `components/discovery/DiscoveryCard.tsx`
- **Changes**: Create basic discovery card component with future enhancement preparation
- **Features**:
  - Photo display
  - Text snippet
  - Category badge
  - Timestamp
  - Location display (if available)
  - Future: Extracted data display (commented for MVP)
  - Future: Processing status indicator (commented for MVP)

#### Timeline Screen
- **File**: `app/(tabs)/index.tsx`
- **Changes**: Replace current content with basic discoveries timeline
- **Features**:
  - Chronological list of discoveries
  - Pull-to-refresh
  - Floating action button to create
  - Future: Search bar (commented for MVP)
  - Future: Filter buttons (commented for MVP)

### Phase 3: Core Services

#### Basic Discovery Service
- **File**: `services/discoveryService.ts`
- **Changes**: Create essential CRUD operations with future scalability
```typescript
- createDiscovery(data: DiscoveryInput): Promise<Discovery>
- getDiscoveries(): Promise<Discovery[]>
- updateDiscovery(id: string, data: Partial<Discovery>): Promise<Discovery>
- deleteDiscovery(id: string): Promise<void>
- getDiscoveryById(id: string): Promise<Discovery | null>

// Future methods (commented for MVP)
/*
- createDiscoveryWithLLM(data: DiscoveryInput): Promise<Discovery>
- getDiscoveriesWithFilters(filters: FilterOptions): Promise<Discovery[]>
- searchDiscoveries(query: string): Promise<Discovery[]>
*/
```

#### Basic Image Service
- **File**: `services/imageService.ts`
- **Changes**: Create basic image handling with EXIF extraction
```typescript
- uploadImage(file: File): Promise<string>
- compressImage(image: ImageSource): Promise<File>
- extractEXIFLocation(image: File): Promise<LocationData | null>
- getImageMetadata(image: File): Promise<ImageMetadata>
```

#### Location Service
- **File**: `services/locationService.ts`
- **Changes**: Create service for location handling
```typescript
- getCurrentLocation(): Promise<LocationData>
- requestLocationPermission(): Promise<boolean>
- reverseGeocode(lat: number, lng: number): Promise<string>
- validateLocation(lat: number, lng: number): boolean
- getLocationFromEXIF(image: File): Promise<LocationData | null>
```

### Phase 4: State Management

#### Basic Discovery Store
- **File**: `stores/discoveryStore.ts`
- **Changes**: Create basic Zustand store with future scalability
```typescript
interface DiscoveryStore {
  discoveries: Discovery[];
  isLoading: boolean;
  error: string | null;
  
  // Actions
  createDiscovery: (data: DiscoveryInput) => Promise<void>;
  fetchDiscoveries: () => Promise<void>;
  updateDiscovery: (id: string, data: Partial<Discovery>) => Promise<void>;
  deleteDiscovery: (id: string) => Promise<void>;
  clearError: () => void;
  
  // Future actions (commented for MVP)
  /*
  retryProcessing: (discoveryId: string) => Promise<void>;
  searchDiscoveries: (query: string) => Promise<void>;
  filterDiscoveries: (filters: FilterOptions) => Promise<void>;
  */
}
```

### Phase 5: Integration

#### Navigation Updates
- **File**: `app/(tabs)/_layout.tsx`
- **Changes**: Add create tab
```typescript
- Add create tab with plus icon
- Update existing tab icons
- Future: Add search tab (commented for MVP)
```

#### Basic Form Validation
- **File**: `schemas/discoverySchema.ts`
- **Changes**: Create basic Zod schema
```typescript
- Text content validation (required, max length)
- Category validation (enum)
- Discovery type validation (optional enum)
- Location validation (optional coordinates)
- Image validation (optional, file size/type)
```

## Algorithms

### Basic Discovery Creation Flow
1. **User Input**: Text, photo, category, type
2. **Location Capture**: Automatically capture GPS location or extract from EXIF
3. **Local Validation**: Client-side form validation
4. **Image Upload**: Upload to Supabase Storage (if photo)
5. **Discovery Save**: Save to Supabase database with location data
6. **UI Update**: Refresh timeline with new discovery

### Location Capture Algorithm
1. **Permission Check**: Request location permission if not granted
2. **GPS Capture**: Try to get current GPS location
3. **EXIF Fallback**: If GPS fails, extract location from photo EXIF
4. **Manual Option**: Allow user to manually set location if needed
5. **Reverse Geocoding**: Convert coordinates to readable location name
6. **Data Storage**: Save location with source tracking

### Basic Image Processing
1. **Capture/Selection**: Use Expo Camera or Image Picker
2. **Compression**: Resize and compress image
3. **Upload**: Upload to Supabase Storage bucket
4. **URL Generation**: Get public URL for image

## Files to Create/Modify

### New Files
- `app/(tabs)/create.tsx`
- `components/discovery/DiscoveryCard.tsx`
- `services/discoveryService.ts`
- `services/imageService.ts`
- `services/locationService.ts`
- `stores/discoveryStore.ts`
- `types/discovery.ts`
- `schemas/discoverySchema.ts`

### Modified Files
- `app/(tabs)/index.tsx` - Replace with timeline view
- `app/(tabs)/_layout.tsx` - Add create tab
- `package.json` - Add new dependencies
- `app.json` - Add camera and location permissions

### Dependencies to Add
```json
{
  "expo-camera": "latest",
  "expo-image-picker": "latest",
  "expo-location": "latest",
  "exif-reader": "latest",
  "react-hook-form": "latest",
  "@hookform/resolvers": "latest",
  "zod": "latest"
}
```

## Success Criteria
- [ ] Users can create discoveries with text and photos
- [ ] Users can categorize discoveries (Liked It, Didn't Like It, Want to Try)
- [ ] Users can select discovery types
- [ ] Location is automatically captured (GPS or EXIF)
- [ ] Users can manually edit location if needed
- [ ] Location data is stored with source tracking
- [ ] Discoveries appear in chronological timeline
- [ ] Users can refresh timeline to see new discoveries
- [ ] Image upload works correctly
- [ ] Form validation prevents invalid submissions
- [ ] Database schema supports future LLM and queue features
- [ ] Type definitions are ready for future enhancements 