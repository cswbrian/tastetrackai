# Feature 0006: Multiple Discovery View Options

## Context
Implement multiple view options for discoveries beyond the basic timeline view. This feature will provide users with different ways to browse and interact with their discoveries, including grid view, map view, and other specialized views.

**Prerequisite**: Features 0001 (Basic Discovery Creation) and 0002 (LLM Integration) must be completed first.

**Future Scope**: Grid view, map view, calendar view, category-based views, and view persistence.

## Technical Plan

### Phase 1: View System Architecture

#### View Configuration Types
- **File**: `types/discoveryViews.ts`
- **Changes**: Define view system types and configurations
```typescript
type DiscoveryViewType = 'timeline' | 'grid' | 'map' | 'calendar' | 'categories';

interface ViewConfig {
  type: DiscoveryViewType;
  name: string;
  icon: string;
  description: string;
  supportsFiltering: boolean;
  supportsSearch: boolean;
  supportsSorting: boolean;
}

interface ViewState {
  currentView: DiscoveryViewType;
  sortBy: 'date' | 'category' | 'type' | 'location';
  sortOrder: 'asc' | 'desc';
  filters: FilterOptions;
  searchQuery: string;
}

interface FilterOptions {
  categories?: ('liked_it' | 'didnt_like_it' | 'want_to_try')[];
  discoveryTypes?: string[];
  dateRange?: { start: Date; end: Date };
  hasLocation?: boolean;
  hasImages?: boolean;
}
```

#### View Configuration
- **File**: `config/discoveryViews.ts`
- **Changes**: Define available view configurations
```typescript
export const DISCOVERY_VIEWS: Record<DiscoveryViewType, ViewConfig> = {
  timeline: {
    type: 'timeline',
    name: 'Timeline',
    icon: 'clock',
    description: 'Chronological view of discoveries',
    supportsFiltering: true,
    supportsSearch: true,
    supportsSorting: true
  },
  grid: {
    type: 'grid',
    name: 'Grid',
    icon: 'grid',
    description: 'Visual grid layout',
    supportsFiltering: true,
    supportsSearch: true,
    supportsSorting: true
  },
  map: {
    type: 'map',
    name: 'Map',
    icon: 'map-pin',
    description: 'Geographic view of discoveries',
    supportsFiltering: true,
    supportsSearch: false,
    supportsSorting: false
  },
  calendar: {
    type: 'calendar',
    name: 'Calendar',
    icon: 'calendar',
    description: 'Calendar-based view',
    supportsFiltering: true,
    supportsSearch: true,
    supportsSorting: false
  },
  categories: {
    type: 'categories',
    name: 'Categories',
    icon: 'folder',
    description: 'Category-based organization',
    supportsFiltering: false,
    supportsSearch: true,
    supportsSorting: true
  }
};
```

### Phase 2: View Components

#### View Toggle Component
- **File**: `components/discovery/ViewToggle.tsx`
- **Changes**: Create view selection component
- **Features**:
  - View type selector
  - Quick view switching
  - View-specific options
  - View persistence

#### Grid View Component
- **File**: `components/discovery/GridView.tsx`
- **Changes**: Create grid layout for discoveries
- **Features**:
  - Responsive grid layout
  - Image-focused display
  - Quick preview on tap
  - Grid size options (2x2, 3x3, 4x4)

#### Map View Component
- **File**: `components/discovery/MapView.tsx`
- **Changes**: Create map-based discovery view
- **Features**:
  - Interactive map display
  - Discovery markers
  - Cluster markers for dense areas
  - Location-based filtering
  - Map zoom and pan controls

#### Calendar View Component
- **File**: `components/discovery/CalendarView.tsx`
- **Changes**: Create calendar-based discovery view
- **Features**:
  - Monthly calendar layout
  - Discovery indicators on dates
  - Date range selection
  - Daily discovery list

#### Categories View Component
- **File**: `components/discovery/CategoriesView.tsx`
- **Changes**: Create category-based organization view
- **Features**:
  - Category grouping
  - Category statistics
  - Quick category switching
  - Category-based insights

### Phase 3: Enhanced Discoveries Screen

#### Main Discoveries Screen
- **File**: `app/(tabs)/discoveries.tsx`
- **Changes**: Enhance with view system
- **Features**:
  - View toggle in header
  - View-specific controls
  - Dynamic content based on view
  - View state persistence
  - Search and filter integration

#### View-Specific Features
- **Timeline View**: Chronological list with pull-to-refresh
- **Grid View**: Visual grid with image previews
- **Map View**: Interactive map with location markers
- **Calendar View**: Calendar layout with date indicators
- **Categories View**: Category-based organization

### Phase 4: State Management

#### View Store
- **File**: `stores/viewStore.ts`
- **Changes**: Create store for view state management
```typescript
interface ViewStore {
  currentView: DiscoveryViewType;
  viewState: ViewState;
  viewHistory: DiscoveryViewType[];
  
  // Actions
  setView: (view: DiscoveryViewType) => void;
  setSortBy: (sortBy: ViewState['sortBy']) => void;
  setSortOrder: (order: 'asc' | 'desc') => void;
  setFilters: (filters: FilterOptions) => void;
  setSearchQuery: (query: string) => void;
  resetView: () => void;
  goBack: () => void;
}
```

#### Enhanced Discovery Store
- **File**: `stores/discoveryStore.ts`
- **Changes**: Add view-specific data handling
```typescript
interface DiscoveryStore {
  // ... existing properties
  
  // View-specific data
  discoveriesByView: Record<DiscoveryViewType, Discovery[]>;
  mapData: MapDiscovery[];
  calendarData: CalendarDiscovery[];
  categoryData: CategoryDiscovery[];
  
  // Actions
  getDiscoveriesForView: (view: DiscoveryViewType) => Discovery[];
  getMapDiscoveries: () => MapDiscovery[];
  getCalendarDiscoveries: () => CalendarDiscovery[];
  getCategoryDiscoveries: () => CategoryDiscovery[];
}
```

### Phase 5: Data Processing

#### View-Specific Data Processing
- **File**: `services/discoveryViewService.ts`
- **Changes**: Create service for view-specific data processing
```typescript
- processForTimeline(discoveries: Discovery[]): TimelineDiscovery[]
- processForGrid(discoveries: Discovery[]): GridDiscovery[]
- processForMap(discoveries: Discovery[]): MapDiscovery[]
- processForCalendar(discoveries: Discovery[]): CalendarDiscovery[]
- processForCategories(discoveries: Discovery[]): CategoryDiscovery[]
- applyFilters(discoveries: Discovery[], filters: FilterOptions): Discovery[]
- applySearch(discoveries: Discovery[], query: string): Discovery[]
- applySorting(discoveries: Discovery[], sortBy: string, order: string): Discovery[]
```

### Phase 6: Performance Optimization

#### View-Specific Optimization
- **File**: `utils/viewOptimization.ts`
- **Changes**: Create optimization utilities for different views
```typescript
- optimizeTimelineRendering(discoveries: Discovery[]): OptimizedTimelineData
- optimizeGridRendering(discoveries: Discovery[]): OptimizedGridData
- optimizeMapRendering(discoveries: Discovery[]): OptimizedMapData
- optimizeCalendarRendering(discoveries: Discovery[]): OptimizedCalendarData
- lazyLoadImages(discoveries: Discovery[]): Promise<void>
- preloadViewData(view: DiscoveryViewType): Promise<void>
```

## Algorithms

### View Switching Algorithm
1. **View Selection**: User selects new view type
2. **State Persistence**: Save current view state
3. **Data Processing**: Process discoveries for new view
4. **Component Rendering**: Render view-specific component
5. **Animation**: Smooth transition between views
6. **State Restoration**: Restore view-specific state

### Map Clustering Algorithm
1. **Marker Calculation**: Calculate discovery locations
2. **Cluster Detection**: Group nearby markers
3. **Cluster Creation**: Create cluster markers
4. **Zoom Level Handling**: Adjust clusters based on zoom
5. **Performance Optimization**: Limit visible markers

### Calendar Data Processing
1. **Date Grouping**: Group discoveries by date
2. **Calendar Grid**: Create calendar grid structure
3. **Date Indicators**: Add discovery indicators to dates
4. **Month Navigation**: Handle month switching
5. **Date Range Selection**: Support date range filtering

### Grid Optimization Algorithm
1. **Image Preloading**: Preload visible images
2. **Grid Calculation**: Calculate optimal grid layout
3. **Responsive Design**: Adjust grid based on screen size
4. **Lazy Loading**: Load images as needed
5. **Memory Management**: Clear off-screen images

## Files to Create/Modify

### New Files
- `types/discoveryViews.ts`
- `config/discoveryViews.ts`
- `components/discovery/ViewToggle.tsx`
- `components/discovery/GridView.tsx`
- `components/discovery/MapView.tsx`
- `components/discovery/CalendarView.tsx`
- `components/discovery/CategoriesView.tsx`
- `services/discoveryViewService.ts`
- `stores/viewStore.ts`
- `utils/viewOptimization.ts`

### Modified Files
- `app/(tabs)/discoveries.tsx` - Add view system
- `stores/discoveryStore.ts` - Add view-specific data
- `components/discovery/DiscoveryCard.tsx` - Optimize for different views
- `types/discovery.ts` - Add view-specific types

### Dependencies to Add
```json
{
  "react-native-maps": "latest",
  "react-native-calendars": "latest",
  "react-native-reanimated": "latest",
  "react-native-gesture-handler": "latest"
}
```

## Success Criteria
- [ ] Users can switch between timeline, grid, map, calendar, and category views
- [ ] Each view displays discoveries appropriately for its format
- [ ] View state persists across app sessions
- [ ] Map view shows discovery locations with clustering
- [ ] Calendar view shows discoveries by date
- [ ] Grid view provides visual discovery browsing
- [ ] Categories view organizes discoveries by type
- [ ] Search and filtering work across all views
- [ ] View switching is smooth and performant
- [ ] Each view is optimized for its specific use case
- [ ] View-specific features enhance discovery browsing
- [ ] Performance remains good with large discovery sets
